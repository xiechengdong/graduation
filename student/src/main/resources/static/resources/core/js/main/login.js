(function(a){if(typeof jQuery===undefined){console.log("jQuery not loaded!")}else{$(function(){wssip.url.init();var i=function(){if(miniwin.getTop()!==a){miniwin.getTop().location=a.href}};i();var b=wssip.url.getParam("winmode")==="popup",g=true||b,j=wssip.url.getUrl("loginCheck"),h=wssip.url.getUrl("captcha"),f=wssip.url.getUrl("logout");if(b){$("body").addClass("popup-win")}var c=function(k){if(a.CloseOwnerWindow){return a.CloseOwnerWindow(k)}else{a.close()}};var d=function(){$("img.captcha").parents("div.row").first().removeClass("hide");$("img.captcha").attr("src",wssip.url.addUrlParam(h,{rnd:Math.random()}))};var e=function(k){$("div.alert").removeClass("hide");if(k){$("div.alert").show()}else{$("div.alert").hide()}$("div.alert > span").text(k)};$("img.captcha").on("click",d);$("#loginForm").attr("action",j);$("#loginForm").on("submit",function(n){var k=$(this).find('[name="password"]');var m=k.val();var p=$(this).find('[name="username"]').val();var l=$(this).find('[name="captcha"]').val();if(!p){var o=$(this).find('[name="username"]').attr("placeholder")||"登陆账号";e("请输入"+o);return false}if(!m){e("请输入密码");return false}if(site&&site.crypto&&site.crypto.password_rsa_eanble){m=wdutil.crypto.rsa.encrypt(m);if(!g){k.val(m)}}if(g){wdutil.request({type:"post",url:j+"?rnd="+Math.random(),dataType:"json",data:{username:p,password:m,captcha:l},success:function(r){console.log("登陆成功",r);if(b){c()}else{var q=wssip.url.getUrl(r.data||r)||r.data||r;console.log("url",q);top.location.href=q}},error:function(r,q){console.log("request error: ",r,q);if(q&&q.errorCount>=1){$("img.captcha").trigger("click")}e(r);return true}});return false}else{return true}});$(".btn-login").on("click",function(){$("#loginForm").submit();return false});$("img.captcha").on("load",function(){$(".btn-login").removeAttr("disabled")})})}})(window);