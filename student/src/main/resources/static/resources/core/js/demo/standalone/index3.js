var listAction={"grid":null,currentrowindex:0,init:function(){this.grid=mini.get("datagrid1");this.grid.on("beforeload",function(b){var a={};b.data=a})},fixResultHeight:function(a){},onKeyEnter:function(a){listAction.grid.reload()},doReset:function(){listAction.grid.clearRows()},doToggleMoreQuery:function(c){var b=c.sender;var a=$(b.el).parents("div.mini-toolbar").prev("div");$(a).slideToggle("fast",function(){if($(this).is(":visible")){b.setIconCls("fa fa-chevron-up")}else{b.setIconCls("fa fa-chevron-down")}mini.callMiniLayout()})},doQuery:function(){listAction.grid.reload();mini.layout()},doQueryClear:function(){listAction.grid.reload()},edit:function(a){var b=[];if(a!=undefined&&a!=null){b.push(listAction.grid.getRowByUID(a))}else{b=listAction.grid.getSelecteds()}if(!b||b.length==0){return}if(b.length>1){wdutil.win.alert("只能单项编辑");return}listAction.editRecord(b[0])},view:function(a){var b=[];if(a!=undefined&&a!=null){b.push(listAction.grid.getRowByUID(a))}else{b=listAction.grid.getSelecteds()}if(!b||b.length==0){return}if(b.length>1){wdutil.win.alert("只能单项查看");return}listAction.viewRecord(b[0])},onRowdblclick:function(a){listAction.currentrowindex=listAction.grid.indexOf(a.record);listAction.viewRecord(a.record)},onDrawSummaryCell:function(c){if(c.field=="data3"){c.cellHtml="合计：";c.cellStyle="text-align:right;";return}var a=c.result.summary;if(a){if(c.field=="data4"||c.field=="data5"){var b=a[c.field];if(!b){b=0}if(c.column.decimalPlaces){b=b.toFixed(c.column.decimalPlaces)}c.cellHtml="本页："+c.cellHtml+" 总："+b;return}}},onOperatorRenderer:function(b){var a="";a+='<a	class="mini-button mini-button-plain" href="javascript:void(0)"	onclick="listAction.edit('+b.row._uid+')"><i class="fa fa-pencil fa-fw"></i><span class="mini-button-text">修改</span></a>';a+='<span class="separator"></span>';a+='<a	class="mini-button mini-button-plain" href="javascript:void(0)"	onclick="listAction.del('+b.row._uid+')"><i class="fa fa-trash-o fa-fw"></i><span class="mini-button-text">删除</span></a>';a+='<span class="separator"></span>';a+='<a	class="mini-button mini-button-plain" href="javascript:void(0)"	onclick="listAction.view('+b.row._uid+')"><i class="fa fa-file-text-o fa-fw"></i><span class="mini-button-text">查看</span></a>';return a},onDrawCell:function(b){var a=b.record;if(a.data4==2){b.cellStyle+="background:#90EE90;"}},doExportCommon:function(){listAction.grid.exportExcel({type:"xlsx",title:"无模板文件",exportUrl:wssip.url.getUrl("/demo/export/page"),useindexcoloumn:"true",filename:"我没用模板"})},doExport:function(){listAction.grid.exportExcel({title:"模板文件",filename:"我用了模板",template:"demo"})},del:function(a){var b=[];if(a!=undefined&&a!=null){b.push(listAction.grid.getRowByUID(a))}else{b=listAction.grid.getSelecteds()}if(b.length>0){wdutil.win.confirm("确定删除选中记录？",function(d){if(d){var c=wdutil.joinList(b,"id",",");wdutil.submit({url:wssip.url.getUrl("/demo/deleteBatch"),data:{ids:c},success:function(){listAction.grid.reload()}})}})}else{wdutil.win.alert("请选中一条记录")}},editRecord:function(a){listAction.showWin({"id":a.id},function(b){b.setReadOnly(false)})},viewRecord:function(a){listAction.showWin({"id":a.id},function(b){b.setReadOnly(true)})},add:function(){listAction.showWin({},function(a){a.addNew()})},showWin:function(b,d){var a=wssip.url.getUrl("/pages/demo/standalone/edit3.html");var c=$.param(b);a+="?"+c;listAction.formWin=wdutil.win.open({type:"mini",uid:"demo_form_win",data:b,url:a,title:"Demo编辑信息",height:620,width:800,showMaxButton:true,showCloseButton:true,allowResize:true,showModal:true,ondestroy:function(g){var f=this.getIFrameEl();var e=f.contentWindow.fromAction;if(g=="close"&&(e&&e.isChanged())){wdutil.win.confirm("数据被修改了，是不保存关闭吗？","确认关闭",function(h){if(h==="ok"||h===true){e.closeWin("cancel")}});return false}else{return true}},onload:function(){var f=this.getIFrameEl();var e=f.contentWindow.fromAction;if(e){e.afterSave=function(g,h){listAction.grid.reload()};if(d){d(e)}}}})}};$(function(){listAction.init();listAction.grid.setUrl(wssip.url.getUrl("/demo/query"))});