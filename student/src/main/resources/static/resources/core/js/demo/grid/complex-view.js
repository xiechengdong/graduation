var fromAction={form:null,win:null,init:function(){this.form=new mini.Form("formPanel");this.form.setChanged(false)},clear:function(){this.form.clear()},setData:function(c,b){if(typeof listAction==="undefined"){c=mini.clone(c)}fromAction.form.setIsValid(true);var a=wdutil.win.mask("数据查询中...","提示");wdutil.ajax.get({url:site.path.base+"/demo/grid/complex/details/"+c,success:function(e){var d=mini.decode(e);fromAction.form.setChanged(false);fromAction.form.setData(d);wdutil.win.unmask(a)}});if(typeof(b)!=="undefined"){fromAction.setReadOnly(b)}},setReadOnly:function(a){this.form.setReadOnly(a);if(a){mini.get("savebtn").hide()}else{mini.get("savebtn").show()}},isChanged:function(){return this.form.isChanged()},save:function(){var b=this;b.form.validate();if(b.form.isValid()==false){wdutil.win.warn("信息填写不完整或格式不对，请重新输入！");return}var c={};c.name=mini.get("name").getValue();var a=mini.get("id").getValue();wdutil.submit({url:site.path.base+"/demo/grid/complex/details/update/"+a,data:c,success:function(d){b.afterSave(d.data,c.id);b.closeWin("save");b.form.setChanged(false);return true},error:function(d){return false}})},closeWin:function(a){if(window.CloseOwnerWindow){return window.CloseOwnerWindow(a)}else{window.close()}},doCloseWin:function(b){var a=this;if(b=="close"&&a.isChanged()){wdutil.win.confirm("数据被修改了，是不保存关闭吗？","确认关闭",function(c){if(c==="ok"||c===true){a.closeWin("cancel")}});return false}else{a.closeWin(b);return true}}};$(function(){fromAction.init()});