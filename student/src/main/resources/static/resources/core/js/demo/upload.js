var fromAction={form:null,win:null,init:function(){this.form=new mini.Form("formPanel");this.form.setChanged(false)},clear:function(){this.form.clear()},addNew:function(){this.clear()},setData:function(b,a){if(typeof listAction==="undefined"){b=mini.clone(b)}this.form.setIsValid(true);this.form.setData(b,false);this.form.setChanged(false);if(typeof(a)!=="undefined"){this.setReadOnly(a)}},setReadOnly:function(a){this.form.setReadOnly(a);if(a){mini.get("savebtn").hide()}else{mini.get("savebtn").show()}},isChanged:function(){return this.form.isChanged()},save:function(){var a=this;a.form.validate();if(a.form.isValid()==false){wdutil.win.warn("信息填写不完整或格式不对，请重新输入！");return}var b=a.form.getData();wdutil.submit({url:wssip.url.getUrl("/demo/save"),data:b,success:function(c){a.afterSave(c.data,b.id);a.closeWin("save");a.form.setChanged(false);return true},error:function(c){return false}})},closeWin:function(a){if(window.CloseOwnerWindow){return window.CloseOwnerWindow(a)}else{window.close()}},doCloseWin:function(b){var a=this;if(b=="close"&&a.isChanged()){wdutil.win.confirm("数据被修改了，是不保存关闭吗？","确认关闭",function(c){if(c==="ok"||c===true){a.closeWin("cancel")}});return false}else{a.closeWin(b);return true}}};$(function(){fromAction.init()});