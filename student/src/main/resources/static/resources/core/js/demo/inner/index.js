var listAction={"grid":null,currentrowindex:0,init:function(){this.grid=mini.get("datagrid1");this.grid.on("beforeload",function(b){var a={"query":{"keyWord":mini.getByName("keyWord").getValue()}};b.data=wdutil.encode(a)})},fixResultHeight:function(a){},onKeyEnter:function(a){listAction.grid.reload()},doReset:function(){listAction.grid.clearRows()},doQuery:function(){listAction.grid.reload();mini.layout()},doQueryClear:function(){listAction.grid.reload()},edit:function(a){var b=[];if(a!=undefined&&a!=null){b.push(listAction.grid.getRowByUID(a))}else{b=listAction.grid.getSelecteds()}if(!b||b.length==0){return}if(b.length>1){wdutil.win.alert("只能单项编辑");return}listAction.editRecord(b[0])},view:function(a){var b=[];if(a!=undefined&&a!=null){b.push(listAction.grid.getRowByUID(a))}else{b=listAction.grid.getSelecteds()}if(!b||b.length==0){return}if(b.length>1){wdutil.win.alert("只能单项查看");return}listAction.viewRecord(b[0])},onRowdblclick:function(a){listAction.currentrowindex=listAction.grid.indexOf(a.record);listAction.viewRecord(a.record)},onDrawSummaryCell:function(c){if(c.field=="data3"){c.cellHtml="合计：";c.cellStyle="text-align:right;";return}var a=c.result.summary;if(a){if(c.field=="data4"||c.field=="data5"){var b=a[c.field];if(!b){b=0}if(c.column.decimalPlaces){b=b.toFixed(c.column.decimalPlaces)}c.cellHtml="本页："+c.cellHtml+" 总："+b;return}}},onCodeRenderer:mini.DataGrid.urlRendererFactory("1001"),onOperatorRenderer:function(b){var a="";a+='<a	class="mini-button mini-button-plain" href="javascript:void(0)"	onclick="listAction.edit('+b.row._uid+')"><i class="fa fa-pencil fa-fw"></i><span class="mini-button-text">修改</span></a>';a+='<span class="separator"></span>';a+='<a	class="mini-button mini-button-plain" href="javascript:void(0)"	onclick="listAction.del('+b.row._uid+')"><i class="fa fa-trash-o fa-fw"></i><span class="mini-button-text">删除</span></a>';a+='<span class="separator"></span>';a+='<a	class="mini-button mini-button-plain" href="javascript:void(0)"	onclick="listAction.view('+b.row._uid+')"><i class="fa fa-file-text-o fa-fw"></i><span class="mini-button-text">查看</span></a>';return a},onDrawCell:function(b){var a=b.record;if(a.data4==2){b.cellStyle+="background:#90EE90;"}},doExportCommon:function(){listAction.grid.exportExcel({type:"xlsx",title:"无模板文件",exportUrl:wssip.url.getUrl("/demo/export/page"),useindexcoloumn:"true",filename:"我没用模板"})},doExport:function(){listAction.grid.exportExcel({title:"模板文件",filename:"我用了模板",template:"demo"})},del:function(a){var b=[];if(a!=undefined&&a!=null){b.push(listAction.grid.getRowByUID(a))}else{b=listAction.grid.getSelecteds()}if(b.length>0){wdutil.win.confirm("确定删除选中记录？",function(d){if(d){var c=wdutil.joinList(b,"id",",");wdutil.submit({url:wssip.url.getUrl("/demo/deleteBatch"),data:{idList:c},success:function(){listAction.grid.reload()}})}})}else{wdutil.win.alert("请选中一条记录")}},editRecord:function(a){fromAction.setData(a,false);fromAction.win.show()},viewRecord:function(a){fromAction.setData(a,true);fromAction.win.show()},reviewRecord:function(b){var a=wdutil.win.openMini({type:"mini",uid:"demo_review_win",url:site.path.base+"/demo/standalone/edit",title:"Demo编辑信息",height:620,width:800,showMaxButton:false,showCloseButton:true,allowResize:false,showModal:true,ondestroy:function(d){var c=this.getIFrameEl()},onload:function(){var e=this.getIFrameEl();var c=e.contentWindow;var d=c.document}})},add:function(){fromAction.addNew();fromAction.win.show()}};$(function(){listAction.init();listAction.grid.setUrl(wssip.url.getUrl("/demo/query"));$("#formWindow").addClass("mini-window");mini.parse();fromAction.win=mini.get("formWindow");fromAction.win.setHeight(320);fromAction.win.setWidth(480);fromAction.win.hide();fromAction.win.on("beforebuttonclick",function(a){if(a&&a.name&&a.name=="close"){a.cancel=!fromAction.doCloseWin("close")}});fromAction.closeWin=function(a){fromAction.win.hide()};fromAction.afterSave=function(a,b){listAction.grid.reload()}});